:{$PORT:8080} {
	# Backend API routes
	handle /api/* {
		reverse_proxy localhost:5000
	}

	# Health check
	handle /health {
		respond "Caddy OK" 200
	}

	# CRM application - strip /crm prefix
	handle_path /crm* {
		root * /app/crm/dist
		file_server browse
		try_files {path} /index.html
	}

	# Public site (default) - serve static files
	handle {
		root * /app/public-site/dist
		file_server browse
		try_files {path} /index.html
	}

	# Security headers
	header {
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "no-referrer-when-downgrade"
	}

	# Detailed logging
	log {
		output stdout
		format console
		level DEBUG
	}
}
